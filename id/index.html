<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <meta name="description" content="Copoint ile kimliğinizi güvenle doğrulayın" />
  <title>Identity Verification | Copoint</title>

  <!-- Şimdilik favicon & manifest'i kaldırdım, 404 vermesin -->
  <!-- <link rel="icon" href="favicon.ico" /> -->
  <!-- <link rel="manifest" href="manifest.json" /> -->

  <style>
    body {
      margin: 0;
      padding: 0;
      background: #020817;
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
  </style>
</head>
<body>
<noscript>Bu uygulamayı kullanmak için JavaScript'i etkinleştirmeniz gerekiyor.</noscript>

<div
  id="root"
  data-config='{
    "API_HOST": "https://identity.copoint.id",
    "UPLOAD_HOST": "https://files.copoint.id",
    "DASHBOARD_HOST": "https://dashboard.copoint.id",
    "STATIC_CDN_PREFIX": "https://cdn.copoint.id/assets",
    "ENV": "sandbox",
    "COMMIT_HASH": "dev-test-001"
  }'
>
  <!-- Buradan sonrası önceki tasarımla aynı -->
  <header style="padding:12px 16px;background:#020617;border-bottom:1px solid rgba(148,163,184,0.3);display:flex;justify-content:space-between;align-items:baseline;gap:12px;">
    <h1 style="margin:0;font-size:16px;letter-spacing:0.02em;">Copoint</h1>
    <div id="status" style="font-size:12px;color:#a5b4fc;">OpenCV yükleniyor…</div>
  </header>

  <div id="main" style="flex:1;display:flex;flex-direction:column;padding:12px 16px 8px;gap:8px;overflow-y:auto;">
    <div id="step-indicator" style="font-size:13px;color:#cbd5f5;">Adım 1 / 3 – Kimlik ön yüz</div>

    <div id="video-container" style="position:relative;border-radius:16px;overflow:hidden;background:radial-gradient(circle at top,#1d2333,#020617);border:1px solid rgba(148,163,184,0.5);aspect-ratio:3/4;max-height:60vh;">
      <video id="video" autoplay playsinline style="width:100%;height:100%;object-fit:cover;"></video>
      <div id="overlay" style="position:absolute;inset:0;border-radius:16px;pointer-events:none;">
        <div id="frame-guide" style="position:absolute;left:50%;top:50%;width:68%;height:42%;transform:translate(-50%,-50%);border-radius:12px;box-shadow:0 0 0 999px rgba(15,23,42,0.72),0 0 0 2px rgba(129,140,248,0.9);outline:1px dashed rgba(165,180,252,0.6);"></div>
        <div id="selfie-circle" style="position:absolute;left:50%;top:50%;width:62%;height:62%;transform:translate(-50%,-50%);border-radius:999px;box-shadow:0 0 0 999px rgba(15,23,42,0.72),0 0 0 2px rgba(129,140,248,0.9);outline:1px dashed rgba(165,180,252,0.6);display:none;"></div>
        <div id="hint" style="position:absolute;left:50%;bottom:12px;transform:translateX(-50%);font-size:12px;padding:6px 10px;border-radius:999px;background:rgba(15,23,42,0.88);color:#e5e7eb;border:1px solid rgba(129,140,248,0.6);backdrop-filter:blur(8px);max-width:90%;text-align:center;">
          Kimliği çerçevenin içine yerleştir, sabit tut. Netleşince otomatik fotoğraf alınacak.
        </div>
        <div id="debug-rect" style="position:absolute;border:2px solid rgba(52,211,153,0.9);border-radius:8px;pointer-events:none;display:none;"></div>
      </div>
    </div>

		<div id="controls" style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;">
		  <button id="restart-btn" type="button" disabled>Bu adımı yeniden çek</button>
		  <button id="manual-btn" type="button" disabled>Manuel çek</button>
		  <button id="next-step-btn" type="button" disabled>Sonraki adıma geç</button>
		</div>

    <div id="step-summary" style="margin-top:8px;padding:8px 10px;border-radius:10px;border:1px dashed rgba(148,163,184,0.5);font-size:12px;color:#9ca3af;">
      <strong>Adımlar:</strong>
      <div>1) Kimlik ön yüz – otomatik kare algılama ve blur kontrolü</div>
      <div>2) Kimlik arka yüz – aynı algoritma</div>
      <div>3) Selfie – manuel çekim</div>
    </div>

    <div id="previews" style="margin-top:8px;display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:6px;">
      <div class="preview-card" style="border-radius:10px;border:1px solid rgba(148,163,184,0.4);overflow:hidden;background:#020617;font-size:11px;">
        <img id="preview-front" alt="Ön yüz" style="width:100%;display:block;" />
        <div style="padding:4px 6px 6px;color:#9ca3af;">Kimlik Ön Yüz</div>
      </div>
      <div class="preview-card" style="border-radius:10px;border:1px solid rgba(148,163,184,0.4);overflow:hidden;background:#020617;font-size:11px;">
        <img id="preview-back" alt="Arka yüz" style="width:100%;display:block;" />
        <div style="padding:4px 6px 6px;color:#9ca3af;">Kimlik Arka Yüz</div>
      </div>
      <div class="preview-card" style="border-radius:10px;border:1px solid rgba(148,163,184,0.4);overflow:hidden;background:#020617;font-size:11px;">
        <img id="preview-selfie" alt="Selfie" style="width:100%;display:block;" />
        <div style="padding:4px 6px 6px;color:#9ca3af;">Selfie</div>
      </div>
    </div>

<button id="submit-btn" type="button" disabled style="margin-top:6px;">
  Hepsini gönder (TEST)
</button>
  </div>

  <section id="test-panel" style="margin:12px 16px 16px;padding:10px 12px;border-radius:12px;border:1px solid rgba(148,163,184,0.4);background:#020617;font-size:12px;">
    <h2 style="margin:0 0 6px;font-size:13px;color:#e5e7eb;">Test Paneli</h2>
    <div class="test-row" style="display:flex;flex-wrap:wrap;gap:8px 16px;align-items:center;margin-bottom:6px;">
      <label style="display:flex;align-items:center;gap:4px;">
        <input type="checkbox" id="debug-toggle">
        Debug modu
      </label>
      <label style="display:flex;align-items:center;gap:4px;">
        <input type="checkbox" id="fake-camera-toggle">
        Fake kamera (görsel yükle)
      </label>
      <input type="file" id="test-image-input" accept="image/*" disabled style="font-size:11px;">
    </div>
    <div class="test-row" style="display:flex;flex-wrap:wrap;gap:8px 16px;align-items:center;margin-bottom:6px;">
      <label style="display:flex;align-items:center;gap:4px;">
        Blur eşiği
        <input type="number" id="blur-threshold" value="80" min="0" max="500" style="width:80px;padding:2px 4px;border-radius:6px;border:1px solid rgba(148,163,184,0.5);background:#020817;color:#e5e7eb;">
      </label>
      <label style="display:flex;align-items:center;gap:4px;">
        Gerekli stabil frame
        <input type="number" id="stable-frames" value="8" min="1" max="60" style="width:80px;padding:2px 4px;border-radius:6px;border:1px solid rgba(148,163,184,0.5);background:#020817;color:#e5e7eb;">
      </label>
      <label style="display:flex;align-items:center;gap:4px;">
        Min kart alan oranı
        <input type="number" id="min-area" value="0.15" step="0.01" min="0.01" max="0.9" style="width:80px;padding:2px 4px;border-radius:6px;border:1px solid rgba(148,163,184,0.5);background:#020817;color:#e5e7eb;">
      </label>
    </div>
    <pre id="debug-info" style="margin:0;padding:6px 8px;border-radius:8px;background:#020617;border:1px dashed rgba(148,163,184,0.4);font-size:11px;color:#9ca3af;max-height:140px;overflow:auto;white-space:pre-wrap;"></pre>
  </section>

  <canvas id="process-canvas" style="display:none;"></canvas>
  <canvas id="capture-canvas" style="display:none;"></canvas>
</div>

<!-- Dikkat: Burada artık RELATIVE path kullanıyoruz -->
<script async src="https://docs.opencv.org/4.x/opencv.js" type="text/javascript"></script>
<script src="main.js"></script>
</body>
</html>
